#!/bin/sh
# ===== Pre-Push Hook =====
# Runs Flutter checks before allowing push

echo "ğŸš€ Running pre-push checks..."

# 1. Get packages
echo "ğŸ“¦ Running flutter pub get..."
flutter pub get
if [ $? -ne 0 ]; then
  echo "âŒ flutter pub get failed."
  exit 1
fi

# 2. Run code generation
echo "âš™ï¸ Running code generation..."
flutter pub run build_runner build --delete-conflicting-outputs
if [ $? -ne 0 ]; then
  echo "âŒ Code generation failed."
  exit 1
fi

# 3. Run intl generation
echo "ğŸŒ Running intl generation..."
flutter pub run intl_utils:generate
if [ $? -ne 0 ]; then
  echo "âŒ Intl generation failed."
  exit 1
fi

# 4. Run analyzer
echo "ğŸ” Running flutter analyze..."
flutter analyze
if [ $? -ne 0 ]; then
  echo "âŒ Lint issues found. Fix them before pushing."
  exit 1
fi

# 5. Run unit tests
echo "ğŸ§ª Running flutter tests..."
flutter test --coverage
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed. Fix them before pushing."
  exit 1
fi

echo "âœ… All checks passed. Proceeding with push..."
exit 0
